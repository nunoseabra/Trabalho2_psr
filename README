Updated code with comments and functions
